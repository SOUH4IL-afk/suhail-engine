import streamlit as st
import datetime
import time

# 1. ูุงุนุฏุฉ ุญุณุงุจ ุงูุฌูู ุงููุจูุฑ (ุงูุนุฏุฏ)
def calculate_abjad(text):
    abjad_map = {
        'ุฃ': 1, 'ุจ': 2, 'ุฌ': 3, 'ุฏ': 4, 'ู': 5, 'ู': 6, 'ุฒ': 7, 'ุญ': 8, 'ุท': 9,
        'ู': 10, 'ู': 20, 'ู': 30, 'ู': 40, 'ู': 50, 'ุณ': 60, 'ุน': 70, 'ู': 80,
        'ุต': 90, 'ู': 100, 'ุฑ': 200, 'ุด': 300, 'ุช': 400, 'ุซ': 500, 'ุฎ': 600,
        'ุฐ': 700, 'ุถ': 800, 'ุธ': 900, 'ุบ': 1000, ' ': 0, 'ุฉ': 5, 'ู': 10, 'ุฆ': 10, 'ุค': 6, 'ุฅ': 1, 'ุข': 1
    }
    return sum(abjad_map.get(char, 0) for char in text)

# 2. ูุงุนุฏุฉ ุงูุทุจุงุฆุน ุงูุฃุฑุจุนุฉ (ูุงุฑุ ุชุฑุงุจุ ููุงุกุ ูุงุก)
def get_element_analysis(text):
    elements = {
        "ูุงุฑู (ุณุฑูุน ุงูุญุฏูุซ)": "ุงูุทููุดุฐ",
        "ุชุฑุงุจู (ุซุงุจุช ูุจุทูุก)": "ุจููุตุชุถ",
        "ููุงุฆู (ูุชููุจ ููุชุฑุฏุฏ)": "ุฌุฒูุณูุซุธ",
        "ูุงุฆู (ุนุงุทูู ูุฎูู)": "ุฏุญูุนุฑุญุฎ"
    }
    scores = {k: sum(1 for char in text if char in v) for k, v in elements.items()}
    return max(scores, key=scores.get)

# --- ูุงุฌูุฉ ุงูุชุทุจูู ---
st.set_page_config(page_title="ุงูุฒุงูุฑุฌุฉ ุงููุจุฑู", page_icon="๐")
st.title("๐ก๏ธ ูุญุฑู ุงูุฒุงูุฑุฌุฉ ุงูุฑูููุฉ ุงููุชูุงูู")
st.markdown("---")

with st.form("grand_matrix"):
    col1, col2 = st.columns(2)
    with col1:
        person = st.text_input("๐ค ุงูุงุณู ุงูุฃูู")
    with col2:
        mother = st.text_input("๐ง ุงุณู ุงูุฃู")
    
    question = st.text_area("โ ุงูุชุจ ุณุคุงูู ุจูุถูุญ")
    submit = st.form_submit_button("ุงุณุชูุทุงู ุงูููุงุนุฏ ุงูู12")

if submit and person and mother and question:
    # ุฃ- ุญุณุงุจ ุงููููุฉ ุงูุฃุณุงุณูุฉ
    val_p = calculate_abjad(person)
    val_m = calculate_abjad(mother)
    val_q = calculate_abjad(question)
    total_val = val_p + val_m + val_q
    
    # ุจ- ูุงุนุฏุฉ ุงูููุช (ุณุงุนุฉ ุงูุณุคุงู)
    now = datetime.datetime.now()
    hour = now.hour
    
    # ุฌ- ูุงุนุฏุฉ ุงูุทุงูุน (ุงูุจุฑุฌ ุงูุฑููู ููุณุคุงู)
    zodiacs = ["ุงูุญูู", "ุงูุซูุฑ", "ุงูุฌูุฒุงุก", "ุงูุณุฑุทุงู", "ุงูุฃุณุฏ", "ุงูุนุฐุฑุงุก", "ุงูููุฒุงู", "ุงูุนูุฑุจ", "ุงูููุณ", "ุงูุฌุฏู", "ุงูุฏูู", "ุงูุญูุช"]
    zodiac_index = total_val % 12
    
    # ุฏ- ุชุญููู ุงูุทุจุงุฆุน
    dominant_element = get_element_analysis(person + question)
    
    with st.spinner('๐ก ุฌุงุฑู ุชูุนูู ูุตูููุฉ ุงูุงุณุชูุทุงู...'):
        time.sleep(2)
        
        st.subheader("๐ ุชุญููู ุงูููุงุนุฏ:")
        c1, c2, c3 = st.columns(3)
        c1.metric("ุงููููุฉ ุงูุนุฏุฏูุฉ", total_val)
        c2.metric("ุทุงูุน ุงูุณุคุงู", zodiacs[zodiac_index])
        c3.metric("ุทุจูุนุฉ ุงูุฃูุฑ", dominant_element.split()[0])

        # ูู- ูุงุนุฏุฉ ุงููุทู ุงูููุงุฆู (ุชูููุฏ ุงูุฅุฌุงุจุฉ)
        # ุฏูุฌ ุงูููุช ูุน ุงูุนุฏุฏ ูุงูุทุจุงุฆุน ููุฎุฑูุฌ ุจุงููุชูุฌุฉ
        logic_gate = (total_val + hour) % 4
        
        results = [
            "โ ุงููุชูุฌุฉ (ูุจูู): ุงูุฃูุฑ ููุณุฑ ููุญุฏุซ ุจุณุฑุนุฉ ุจูุถู ุงูุทุจูุนุฉ ุงููุงุฑูุฉ ุงูุบุงูุจุฉ.",
            "โณ ุงููุชูุฌุฉ (ุชุฃุฌูู): ุงูุฃูุฑ ูุญุชุงุฌ ูุตุจุฑ ูุนูู ุฌุงุฏุ ูุงูุทุงูุน ูุดูุฑ ููุซุจุงุช ุงูุชุฑุงุจู.",
            "โ๏ธ ุงููุชูุฌุฉ (ุชุฑุฏุฏ): ููุงู ุฃุดุฎุงุต ูุคุซุฑูู ุนูู ุงููุฑุงุฑุ ูุงูุฑูุงุญ ูุง ุชุฌุฑู ููุง ุชุดุชูู ุงูุณูู ุญุงููุงู.",
            "๐ ุงููุชูุฌุฉ (ููุน): ููุตุญ ุจุตุฑู ุงููุธุฑ ุนู ูุฐุง ุงูุฃูุฑ ุงูุขูุ ุงูุทุงูุฉ ุงููุญูุทุฉ ุบูุฑ ููุงุณุจุฉ."
        ]
        
        st.markdown("---")
        st.success(f"### ๐ ุงููุทู ุงููุณุชุฎุฑุฌ:\n{results[logic_gate]}")
        
        # ู- ูุงุนุฏุฉ ุงููุตูุญุฉ ุงูุฑูุญูุฉ
        st.info(f"๐ก ูุตูุญุฉ ุงูุฒุงูุฑุฌุฉ: ุทุจูุนุฉ ุณุคุงูู {dominant_element}ุ ูุฐุง ุชุนุงูู ุจุฐูุงุก ูุน ุงูู {zodiacs[zodiac_index]} ูู ูุฐุง ุงูุฃูุฑ.")
        st.balloons()
